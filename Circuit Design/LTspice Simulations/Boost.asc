Version 4
SHEET 1 1132 884
WIRE 48 -64 -48 -64
WIRE 208 -64 128 -64
WIRE 304 -64 208 -64
WIRE 432 -64 368 -64
WIRE 560 -64 432 -64
WIRE 208 -32 208 -64
WIRE 432 -16 432 -64
WIRE 560 -16 560 -64
WIRE -48 32 -48 -64
WIRE 208 144 208 64
WIRE 432 144 432 48
WIRE 560 144 560 64
WIRE -48 160 -48 112
WIRE -176 272 -240 272
WIRE 160 272 -176 272
WIRE 224 272 160 272
WIRE 368 272 224 272
WIRE 224 320 224 272
WIRE 368 320 368 272
WIRE -240 432 -240 272
WIRE 224 432 224 384
WIRE 368 432 368 400
WIRE 304 480 224 480
WIRE 304 512 304 480
WIRE -96 528 -128 528
WIRE 160 528 160 272
WIRE 160 528 128 528
WIRE 224 528 224 480
WIRE 224 528 160 528
WIRE -128 544 -128 528
WIRE -96 592 -144 592
WIRE 224 592 128 592
WIRE 224 624 224 592
WIRE 304 624 304 592
WIRE 304 624 224 624
WIRE -240 656 -240 512
WIRE -96 656 -240 656
WIRE 160 656 128 656
WIRE 224 656 160 656
WIRE 304 656 304 624
WIRE -176 720 -176 272
WIRE -96 720 -176 720
WIRE 192 720 128 720
WIRE 224 752 224 656
WIRE 304 752 304 736
WIRE 304 752 224 752
WIRE 192 768 192 720
WIRE 304 768 304 752
WIRE -144 800 -144 592
WIRE 160 800 160 656
WIRE 160 800 -144 800
WIRE 192 864 192 832
WIRE 304 864 304 832
FLAG -48 160 0
FLAG 208 144 0
FLAG 432 144 0
FLAG 560 144 0
FLAG 368 432 0
FLAG 224 432 0
FLAG -128 544 0
FLAG 304 864 0
FLAG 160 48 PWM
IOPIN 160 48 In
FLAG 192 864 0
FLAG -240 656 PWM
IOPIN -240 656 Out
SYMBOL voltage -48 16 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {Vs}
SYMBOL ind 32 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 100µ
SYMATTR SpiceLine Rser=56m
SYMBOL nmos 160 -32 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL schottky 304 -48 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 416 -16 R0
SYMATTR InstName C1
SYMATTR Value 47µ
SYMBOL res 544 -32 R0
SYMATTR InstName R1
SYMATTR Value 5
SYMBOL Misc\\NE555 16 624 R0
SYMATTR InstName U1
SYMBOL voltage 368 304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL cap 208 320 R0
SYMATTR InstName C2
SYMATTR Value 0.01µ
SYMBOL res 288 496 R0
SYMATTR InstName R2
SYMATTR Value 47
SYMBOL res 288 640 R0
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL cap 288 768 R0
SYMATTR InstName C3
SYMATTR Value {C}
SYMBOL res -256 416 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL cap 176 768 R0
SYMATTR InstName C4
SYMATTR Value 0.01µ
TEXT 744 -8 Left 2 !.param f=40k
TEXT 744 24 Left 2 !.param T=1/f
TEXT 744 -104 Left 2 !.param Vs=3.7
TEXT 744 -72 Left 2 !.param Vl=9
TEXT 744 -40 Left 2 !.param D=1-Vs/Vl
TEXT -290 50 Left 2 !.tran 0 50ms 0 uic
TEXT 744 56 Left 2 !.param tl = (1-D)/f
TEXT 744 128 Left 2 !.param Rb=tl/(0.693*C)
TEXT 744 88 Left 2 !.param C=0.1u
TEXT 744 160 Left 2 !.param Ra = (D/(f*0.693*C))-Rb
